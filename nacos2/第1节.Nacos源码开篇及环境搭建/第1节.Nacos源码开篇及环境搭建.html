<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nacos源码开篇 | Nacos Guide</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="分享微服务组件Nacos，学习其源码与思想">
    
    <link rel="preload" href="/nacos-guide/assets/css/0.styles.315a301c.css" as="style"><link rel="preload" href="/nacos-guide/assets/js/app.60b565f1.js" as="script"><link rel="preload" href="/nacos-guide/assets/js/2.bcb8ada0.js" as="script"><link rel="preload" href="/nacos-guide/assets/js/4.f6e10ae8.js" as="script"><link rel="prefetch" href="/nacos-guide/assets/js/10.414297eb.js"><link rel="prefetch" href="/nacos-guide/assets/js/11.a90b0310.js"><link rel="prefetch" href="/nacos-guide/assets/js/12.cbf86bc9.js"><link rel="prefetch" href="/nacos-guide/assets/js/13.90b89aae.js"><link rel="prefetch" href="/nacos-guide/assets/js/14.738c7bbb.js"><link rel="prefetch" href="/nacos-guide/assets/js/15.d95b8c4a.js"><link rel="prefetch" href="/nacos-guide/assets/js/16.66e05b23.js"><link rel="prefetch" href="/nacos-guide/assets/js/17.4b4188c6.js"><link rel="prefetch" href="/nacos-guide/assets/js/18.548625a1.js"><link rel="prefetch" href="/nacos-guide/assets/js/19.3fb19de9.js"><link rel="prefetch" href="/nacos-guide/assets/js/20.b428aa50.js"><link rel="prefetch" href="/nacos-guide/assets/js/21.8a694ce3.js"><link rel="prefetch" href="/nacos-guide/assets/js/22.60431afb.js"><link rel="prefetch" href="/nacos-guide/assets/js/23.beabf292.js"><link rel="prefetch" href="/nacos-guide/assets/js/24.27303bad.js"><link rel="prefetch" href="/nacos-guide/assets/js/25.563997aa.js"><link rel="prefetch" href="/nacos-guide/assets/js/26.ec63f162.js"><link rel="prefetch" href="/nacos-guide/assets/js/27.54431b01.js"><link rel="prefetch" href="/nacos-guide/assets/js/28.ceb139ec.js"><link rel="prefetch" href="/nacos-guide/assets/js/29.b88b01c0.js"><link rel="prefetch" href="/nacos-guide/assets/js/3.c4a4c22c.js"><link rel="prefetch" href="/nacos-guide/assets/js/30.b7181648.js"><link rel="prefetch" href="/nacos-guide/assets/js/31.30443e1f.js"><link rel="prefetch" href="/nacos-guide/assets/js/32.82114ebd.js"><link rel="prefetch" href="/nacos-guide/assets/js/33.19fff8f7.js"><link rel="prefetch" href="/nacos-guide/assets/js/34.4bd4fa81.js"><link rel="prefetch" href="/nacos-guide/assets/js/35.2d7b3a68.js"><link rel="prefetch" href="/nacos-guide/assets/js/36.cc5e6ecc.js"><link rel="prefetch" href="/nacos-guide/assets/js/37.a6e1f603.js"><link rel="prefetch" href="/nacos-guide/assets/js/38.79ff3cc1.js"><link rel="prefetch" href="/nacos-guide/assets/js/39.64e41f37.js"><link rel="prefetch" href="/nacos-guide/assets/js/40.a940545b.js"><link rel="prefetch" href="/nacos-guide/assets/js/41.6c20bb56.js"><link rel="prefetch" href="/nacos-guide/assets/js/42.b1edc063.js"><link rel="prefetch" href="/nacos-guide/assets/js/43.de2be6af.js"><link rel="prefetch" href="/nacos-guide/assets/js/44.02e3dd7b.js"><link rel="prefetch" href="/nacos-guide/assets/js/45.23034a35.js"><link rel="prefetch" href="/nacos-guide/assets/js/46.b575e120.js"><link rel="prefetch" href="/nacos-guide/assets/js/47.abaf58c3.js"><link rel="prefetch" href="/nacos-guide/assets/js/48.b00979df.js"><link rel="prefetch" href="/nacos-guide/assets/js/49.0fe2d605.js"><link rel="prefetch" href="/nacos-guide/assets/js/5.4fed097f.js"><link rel="prefetch" href="/nacos-guide/assets/js/50.c72a411d.js"><link rel="prefetch" href="/nacos-guide/assets/js/51.9d1222ac.js"><link rel="prefetch" href="/nacos-guide/assets/js/52.ea1fc83f.js"><link rel="prefetch" href="/nacos-guide/assets/js/6.7e831ffb.js"><link rel="prefetch" href="/nacos-guide/assets/js/7.ee4b8294.js"><link rel="prefetch" href="/nacos-guide/assets/js/8.7b939dff.js"><link rel="prefetch" href="/nacos-guide/assets/js/9.b0e9368c.js">
    <link rel="stylesheet" href="/nacos-guide/assets/css/0.styles.315a301c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nacos-guide/" class="home-link router-link-active"><!----> <span class="site-name">Nacos Guide</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/nacos-guide/guide/list/01.html" class="nav-link">
  导读
</a></div><div class="nav-item"><a href="/nacos-guide/basic/" class="nav-link">
  基本使用
</a></div><div class="nav-item"><a href="/nacos-guide/nacos2/" class="nav-link router-link-active">
  Nacos2源码分析
</a></div><div class="nav-item"><a href="/nacos-guide/design/" class="nav-link">
  Nacos代码设计
</a></div><div class="nav-item"><a href="/nacos-guide/pattern/" class="nav-link">
  Nacos设计模式
</a></div><div class="nav-item"><a href="/nacos-guide/question/" class="nav-link">
  常见问题
</a></div><div class="nav-item"><a href="/nacos-guide/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/wuchubuzai2018/nacos-guide" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/nacos-guide/guide/list/01.html" class="nav-link">
  导读
</a></div><div class="nav-item"><a href="/nacos-guide/basic/" class="nav-link">
  基本使用
</a></div><div class="nav-item"><a href="/nacos-guide/nacos2/" class="nav-link router-link-active">
  Nacos2源码分析
</a></div><div class="nav-item"><a href="/nacos-guide/design/" class="nav-link">
  Nacos代码设计
</a></div><div class="nav-item"><a href="/nacos-guide/pattern/" class="nav-link">
  Nacos设计模式
</a></div><div class="nav-item"><a href="/nacos-guide/question/" class="nav-link">
  常见问题
</a></div><div class="nav-item"><a href="/nacos-guide/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/wuchubuzai2018/nacos-guide" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基于Nacos2.1.0</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nacos-guide/nacos2/第1节.Nacos源码开篇及环境搭建/第1节.Nacos源码开篇及环境搭建.html" class="active sidebar-link">第1节.Nacos源码开篇及环境搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nacos-guide/nacos2/第1节.Nacos源码开篇及环境搭建/第1节.Nacos源码开篇及环境搭建.html#nacos服务注册与发现源码剖析" class="sidebar-link">Nacos服务注册与发现源码剖析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nacos-guide/nacos2/第1节.Nacos源码开篇及环境搭建/第1节.Nacos源码开篇及环境搭建.html#nacos核心功能点" class="sidebar-link">Nacos核心功能点</a></li><li class="sidebar-sub-header"><a href="/nacos-guide/nacos2/第1节.Nacos源码开篇及环境搭建/第1节.Nacos源码开篇及环境搭建.html#nacos服务端原理" class="sidebar-link">Nacos服务端原理</a></li><li class="sidebar-sub-header"><a href="/nacos-guide/nacos2/第1节.Nacos源码开篇及环境搭建/第1节.Nacos源码开篇及环境搭建.html#nacos客户端原理" class="sidebar-link">Nacos客户端原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/nacos-guide/nacos2/第1节.Nacos源码开篇及环境搭建/第1节.Nacos源码开篇及环境搭建.html#nacos源码下载" class="sidebar-link">Nacos源码下载</a></li></ul></li><li><a href="/nacos-guide/nacos2/第2节.Nacos客户端服务注册源码分析/第2节.Nacos客户端服务注册源码分析.html" class="sidebar-link">第2节.Nacos客户端服务注册源码分析</a></li><li><a href="/nacos-guide/nacos2/第3节.Nacos服务端服务注册之基本处理1/第3节.Nacos服务端服务注册之基本处理流程.html" class="sidebar-link">第3节.服务端服务注册之基本处理流程</a></li><li><a href="/nacos-guide/nacos2/第4节.Nacos服务端服务注册之基本处理2/第4节.Nacos服务端服务注册之Distro协议注册与异步复制.html" class="sidebar-link">第4节.服务端服务注册之Distro协议注册与异步复制</a></li><li><a href="/nacos-guide/nacos2/第5节.Nacos中的DistroFilter服务注册路由/第5节.Nacos中的DistroFilter服务注册路由.html" class="sidebar-link">第5节.Nacos中的DistroFilter服务注册路由</a></li><li><a href="/nacos-guide/nacos2/第6节.Nacos服务端服务健康检查源码分析/第6节.Nacos服务端服务健康检查源码分析.html" class="sidebar-link">第6节.Nacos服务端服务健康检查源码分析</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nacos源码开篇"><a href="#nacos源码开篇" class="header-anchor">#</a> Nacos源码开篇</h1> <h2 id="nacos服务注册与发现源码剖析"><a href="#nacos服务注册与发现源码剖析" class="header-anchor">#</a> Nacos服务注册与发现源码剖析</h2> <h3 id="nacos核心功能点"><a href="#nacos核心功能点" class="header-anchor">#</a> Nacos核心功能点</h3> <p><strong>服务注册</strong>：Nacos Client会通过发送REST请求的方式向Nacos Server注册自己的服务，提供自身的元数据，比如ip地址、端口等信息。Nacos Server接收到注册请求后，就会把这些元数据信息存储在一个双层的内存Map中。</p> <p><strong>服务心跳</strong>：在服务注册后，Nacos Client会维护一个定时心跳来持续通知Nacos Server，说明服务一直处于可用状态，防止被剔除。默认5s发送一次心跳。</p> <p><strong>服务健康检查</strong>：Nacos Server会开启一个定时任务用来检查注册服务实例的健康情况，对于超过15s没有收到客户端心跳的实例会将它的healthy属性置为false(客户端服务发现时不会发现)，如果某个实例超过30秒没有收到心跳，直接剔除该实例(被剔除的实例如果恢复发送心跳则会重新注册)</p> <p><strong>服务发现</strong>：服务消费者（Nacos Client）在调用服务提供者的服务时，会发送一个REST请求给Nacos Server，获取上面注册的服务清单，并且缓存在Nacos Client本地，同时会在Nacos Client本地开启一个定时任务定时拉取服务端最新的注册表信息更新到本地缓存</p> <p><strong>服务同步</strong>：Nacos Server集群之间会互相同步服务实例，用来保证服务信息的一致性。</p> <h3 id="nacos服务端原理"><a href="#nacos服务端原理" class="header-anchor">#</a> Nacos服务端原理</h3> <p><img src="/nacos-guide/assets/img/20190703005818162.35053b71.png" alt="在这里插入图片描述"></p> <h3 id="nacos客户端原理"><a href="#nacos客户端原理" class="header-anchor">#</a> Nacos客户端原理</h3> <p><img src="/nacos-guide/assets/img/20190703005828565.e48e6ff1.png" alt="在这里插入图片描述"></p> <p>​	其实从以上的两张图中我们就能够找到突破口了，其实核心内容就集中在nacos-console、nacos-naming、nacos-config，这几个模块中。那么知道了这些，现在我们就来进行Nacos的源码下载，然后我们具体分析。</p> <h2 id="nacos源码下载"><a href="#nacos源码下载" class="header-anchor">#</a> Nacos源码下载</h2> <p>我们本次需要通过IDEA2021.2开发工具来运行Nacos，所以提前下载好Nacos2.1的源代码：</p> <p>下载地址为：https://github.com/alibaba/nacos/releases，然后解压到磁盘的某个目录下，并进行IDEA的导入。</p> <p><strong>1、编译项目工程</strong></p> <p><img src="/nacos-guide/assets/img/20220630-114546.0f2ca3c5.png" alt="Nacos源码编译"></p> <p><strong>2、源码单机运行：</strong></p> <p>首先要找到nacos-console这个模块，直接运行console模块里的 com.alibaba.nacos.Nacos.java，运行的时候，在IDEA的JVM的启动参数中增加为独立运行模式，和Nacos的主目录，如图所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">-</span><span class="token class-name">Dnacos</span><span class="token punctuation">.</span>standalone<span class="token operator">=</span><span class="token boolean">true</span> <span class="token operator">-</span><span class="token class-name">Dnacos</span><span class="token punctuation">.</span>home<span class="token operator">=</span><span class="token operator">/</span>develop<span class="token operator">/</span>nacos<span class="token operator">/</span>nacos<span class="token operator">-</span><span class="token number">2.1</span><span class="token number">.0</span>
</code></pre></div><p><img src="/nacos-guide/assets/img/20220630-115829.a29cce03.png" alt="启动参数配置"></p> <p>配置好之后就可以运行测试，和启动普通的SpringBoot聚合项目一样，启动之后我们也可以直接访问：http://localhost:8848/nacos，这个时候就能看到我们以前看到的对应客户端页面了，到此为止我们的Nacos源码启动就完成了。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/30/2022, 12:05:05 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/nacos-guide/nacos2/第2节.Nacos客户端服务注册源码分析/第2节.Nacos客户端服务注册源码分析.html">
        第2节.Nacos客户端服务注册源码分析
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/nacos-guide/assets/js/app.60b565f1.js" defer></script><script src="/nacos-guide/assets/js/2.bcb8ada0.js" defer></script><script src="/nacos-guide/assets/js/4.f6e10ae8.js" defer></script>
  </body>
</html>
