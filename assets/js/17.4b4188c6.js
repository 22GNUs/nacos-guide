(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{294:function(s,a,t){"use strict";t.r(a);var e=t(13),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"第7节-linux环境部署nacos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第7节-linux环境部署nacos"}},[s._v("#")]),s._v(" 第7节.Linux环境部署Nacos")]),s._v(" "),t("h2",{attrs:{id:"一、安装java"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、安装java"}},[s._v("#")]),s._v(" 一、安装Java")]),s._v(" "),t("p",[s._v("将jdk1.8的安装包上传到/opt/app下，并解压重命名为jdk1.8。")]),s._v(" "),t("p",[s._v("然后在/etc/profile文件中，增加如下环境变量：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/app/jdk1.8\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/bin\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLASSPATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/lib/tools.jar:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/lib/dt.jar\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" JAVA_HOME\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" CLASSPATH\n")])])]),t("p",[s._v("保存退出后，执行source /etc/profile生效。")]),s._v(" "),t("h2",{attrs:{id:"二、集群部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、集群部署"}},[s._v("#")]),s._v(" 二、集群部署")]),s._v(" "),t("p",[s._v("准备3台服务器，并进行规划，这里安装时将服务器的防火墙暂时关闭，也可以将三台服务器之前的网络设置为可信任的。")]),s._v(" "),t("p",[s._v("1、在每台节点上，将Nacos2.1的部署包上传到每台服务器的/opt/app目录下，解压并重命名为nacos2.1。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf nacos2.1.tar.gz\n")])])]),t("p",[s._v("2、在每台节点上，修改配置文件，将外部的数据库配置信息增加到nacos安装目录下的conf文件夹下的application.properties文件中。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#*************** Config Module Related Configurations ***************#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### If use MySQL as datasource:")]),s._v("\nspring.datasource.platform"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### Count of DB:")]),s._v("\ndb.num"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### Connect URL of DB:")]),s._v("\ndb.url.0"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connectTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("socketTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("autoReconnect")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("useUnicode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("useSSL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("serverTimezone")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("UTC"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("allowPublicKeyRetrieval")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\ndb.user.0"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nacos\ndb.password.0"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nacos\n")])])]),t("p",[s._v("3、在每台节点上，修改Nacos启动文件的中的默认JVM参数，默认的JVM参数过大，根据自己的机器配置情况进行修改，在nacos根目录/bin/startup.sh文件中调整JVM参数，大概在文件的93行左右：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MODE}")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"standalone"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -Xms512m -Xmx512m -Xmn256m"')]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -Dnacos.standalone=true"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${EMBEDDED_STORAGE}")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"embedded"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -DembeddedStorage=true"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -server -Xms2G -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(" -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath="),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BASE_DIR}")]),s._v('/logs/java_heapdump.hprof"')]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -XX:-UseLargePages"')]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])])]),t("p",[s._v("4、在每台节点上，配置集群文件，编辑nacos安装目录下的cluster.conf文件，增加集群节点：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nacos主目录\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" cluster.conf.example cluster.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" cluster.conf\n")])])]),t("p",[s._v("增加类似如下IP地址：")]),s._v(" "),t("p",[s._v("192.168.1.2:8848\n192.168.1.3:8848\n192.168.1.4:8848")]),s._v(" "),t("p",[s._v("nacos启动后会占用当前端口、当前端口+1000、当前端口+1001、当前端口-1000。")]),s._v(" "),t("p",[s._v("5、在每台节点上，分别执行启动命令：")]),s._v(" "),t("p",[s._v("cd nacos主目录\nbin/startup.sh")]),s._v(" "),t("p",[s._v("6、浏览器访问验证一下即可")])])}),[],!1,null,null,null);a.default=r.exports}}]);